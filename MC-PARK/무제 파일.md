
## 목차

1. [EC2_인스턴스_생성(t4g)](#EC2_인스턴스_생성(t4g)
2. [RDS_생성하기](#RDS_생성하기)
3. [인덱스3](#인덱스3)
4. [인덱스4](#인덱스4)


# 1. EC2_인스턴스_생성(t4g)

![](https://i.imgur.com/hnj1tcm.png)

## 목표
- AWS EC2(t4g) 인스턴스에 Docker를 활용한 Spring Boot 서버 배포
- Github Actions를 활용한 CI/CD 구축
- AWS RDS, S3 설정
- Nginx reverse proxy 설정


## 아키텍처

![](https://i.imgur.com/lUUzgum.jpg)
## EC2 인스턴스 생성

> [!NOTE]
> - EC2는 AWS에서 제공하는 클라우드 컴퓨팅 서비스로, 아마존이 사용자들에게 독립된 컴퓨터를 임대해주는 서비스이다.
> - EC2를 사용해 가상 서버를 구축하고, 보안 및 네트워킹을 구성해서 빠르게 애플리케이션을 배포할 수 있다.
> - 인스턴스 유형, OS, 소프트웨어 패키지 등을 선택할 수 있고, memory/cpu/storage/booting partition size 등을 선택할 수 있는 유연한 클라우드 호스팅 서비스이다.


### 1.1 AWS Region 설정

Region에 따라 인스턴스 위치가 결정되기 때문에 외국으로 하면 속도가 느릴 수 있다.
console 우측 상단 Region을 서울로 설정한다.

![](https://i.imgur.com/kILVQrc.png)

### EC2 서비스 - 인스턴스 생성

![](https://i.imgur.com/16qn0ND.png)

인스턴스 시작을 통해 EC2를 생성할 수 있다.

![](https://i.imgur.com/4fZhbm2.png)

이름은 비워놓아도 상관 없지만, 임의 값으로 나오기 때문에 프로젝트에 맞춰 설정해주자

### ✅ AMI 및 인스턴스 유형 선택


![](https://i.imgur.com/CznJ9l9.png)


현 시점(2023-09)에는 1년 프리 티어를 제외하고 무료로 사용 할 수 있는 인스턴스 유형은 `t4g.small`이 유일하기 때문에 AMI는 `t4g.small`로 결정했다.
t4g.small은 t2.micro 대비 vCPU와 REM이 2배로 기존 무료 평가판에서 스케일 업도 가능하다. 단점으로 ARM 아키텍처로 사용하는 툴이 이를 지원해야한다는 점이지만 대부분 극복 가능하다.

> [!NOTE]
> AMI(**Amazon Machine Image**)는 인스턴스를 시작하는데 필요한 정보를 제공하는 이미지로, 서버 구성을 어떻게 할지 선택하는 것이라 생각하면 된다.
> 한 AMI로 여러 인스턴스를 생성할 수 있다.

### ✅ 키 페어 생성

![](https://i.imgur.com/WoOrqbu.png)

EC2 서버에 SSH 접속을 하기 위해 키 페어를 생성하자

![](https://i.imgur.com/bYN2PRi.png)

`새 키 페어 생성`을 클릭해 원하는 이름을 입력해 생성한다.  
생성하면 자동으로 `mc-park.pem` 파일이 다운로드 되고, SSH 환경에 접속하기 위해서는 해당 키 파일이 존재하는 위치로 가서 `ssh` 명령어를 실행하면 된다.
> [!info] 
> 한 번 다운로드 받은 후에는 다시 다운로드 받을 수 없다.

### ✅ 네트워크 및 스토리지 선택

![](https://i.imgur.com/fPv2cpb.png)


네트워크 설정은 EC2에 접속을 허용하는 ACL을 생각하면 된다. 생성 이후에 `보안 그룹`을 별도로 설정할 것이기 때문에 내 IP에서만 SSH 트래픽 접속이 가능하도록 설정해준다.

![](https://i.imgur.com/c3MX5Hx.png)

프리티어는 최대 30까지만 지원하기 때문에 스토리지 부분도 변경해준다. 볼륨 유형은 범용 SSD로 선택해야 한다.
(만약 Provisioned IOPS SSD(프로비저닝된 IOPS SSD)를 선택한다면 사용하지 않아도 활성화한 기간만큼 비용이 발생하게 된다.)

다른 세부 설정은 기본 값으로 두고 요약 페이지를 통해 전체 설정을 확인 한 후 이상이 없다면 인스턴스 시작을 통해 생성한다.
### ✅ 인스턴스 시작하기

![](https://i.imgur.com/LXUgYmq.png)

인스턴스가 잘 생성되었다면 탄력적 IP 설정을 통해 고정 IP를 획득하고 보안 그룹을 추가한다.


# 1-2. 탄력적(Elastic) IP

EC2 인스턴스를 생성할 때는 항상 새로운 IP를 할당한다. 인스턴스를 중지하고 재시작하는 경우에도 새로운 IP가 할당 되기 때문에 매 번 관련 설정을 변경해야하는 번거로움이 생긴다.

`탄력적 IP`란 외부에서 인스턴스에 접근 가능한 고정 IP이다. 고정적인 IP를 가질 수 있도록 탄력적 IP 주소를 할당해주어야 한다.

> [!NOTE]
> 탄력적 IP를 만들고 EC2에 연결하지 않으면 과금이 되기 때문에 주의해야 한다. 필요한 만큼만 생성하는 것이 중요하다.


## 1-2.1 탄력적 IP 할당하기

EC2 페이지 좌측 메뉴 `네트워크 및 보안`에서 탄력적 IP를 찾을 수 있다.

![](https://i.imgur.com/pA8ARPI.png)
![](https://i.imgur.com/CPCp6cu.png)

여기서 탄력적 IP 주소 할당을 통해 새로운 IP 주소를 추가해보자

![](https://i.imgur.com/m0LHSBJ.png)

특별히 변경할 내용은 없으니 바로 할당 버튼을 클릭한다.

## 1-2.2 탄력적 IP 인스턴스와 연결하기

![](https://i.imgur.com/FMy8PiY.png)

생성한 탄력적 IP를 선택한 후 작업 - 탄력적 IP 주소 연결을 누른다.

![](https://i.imgur.com/k7MN4EY.png)

현재 내 인스턴스 목록을 선택할 수 있고 연결된 프라이빗 IP까지 선택 가능하다.

연결 버튼을 클릭한 후, 인스턴스 정보를 확인하면 `퍼블릭 IPv4 주소`와 `탄력적 IP 주소`의 값이 동일하다는 것을 확인할 수 있다.

# 1-3. SSH 클라이언트 서버 접속하기


![](https://i.imgur.com/YRofTvj.png)

1번부터 4번까지 나열된 순서대로 진행한다.

터미널을 통해 다운받은 키 페어가 있는 파일 위치로 이동하자.

![](https://i.imgur.com/LpjMwK1.png)

## 1-3.1키 파일 권한 변경

```sql
$ chmod 400 키페어이름.pem
```

## 1-3.2SSH 접속하기

SSH 접속은 퍼블릭 DNS 또는 퍼블릭 IP를 사용해 인스턴스에 접속할 수 있다.

```javascript
ssh -i "키페어이름.pem" ubuntu@<퍼블릭DNS>

ssh -i "키페어이름.pem" ubuntu@<퍼블릭IP>
```

## 1-3.3호스트를 등록해 간편 접속

### ✅ ./ssh 디렉터리로 키 페어 파일 복사하기

```javascript
$ cp 키페어이름.pem ~/.ssh/
```

### ✅ 키페어 파일의 권한 변경하기

```javascript
$ cd ~/.ssh
$ chmod 600 키페어이름.pem
```

### ✅ ~/.ssh/config 파일 생성하기

```javascript
$ vi ~/.ssh/config
```

이미 파일이 존재한다면 맨 아래에 입력하면 된다.  
User는 ubuntu를 선택했다면 `ubuntu`이고 그 외는 `ec2-user`이다.

> [!NOTE]
> - Host {원하는 호스트 이름}  
> - User {유저 이름}  
> - HostName {탄력적 IP}  
> - IdentityFile {키 페어 파일 위치}
> ![](https://i.imgur.com/H3mNhX1.png)


설정을 끝냈다면 host 이름으로 간단하게 접속할 수 있다.

```null
ssh  mc-park
```


# 1-4. 보안 그룹 설정하기

보안 그룹은 AWS에서 제공하는 방화벽 기능이다. RDS 처럼 외부에서 함부로 접근하면 안되는 인스턴스는 허용된 IP에서만 접근하도록 설정이 필요하다.

> - 인바운드 : 외부에서 EC2 인스턴스 내부로의 접근을 허용
> - 아웃바운드 : EC2 인스턴스 내부에서 외부로의 접근을 허용


## 1-4.1 현재 보안 그룹 확인

보안 그룹은 인스턴스 요약 하단 혹은 EC2 페이지 좌측 패널에서 확인 할 수 있다.
처음 인스턴스를 생성했을 때 자동으로 할당 되는 Default 보안그룹은 22번 포트의 내 IP에 대한 TCP 연결을 허용하도록 설정되어 있다.
우리는 RDS, IPv4, IPv6 그리고 Docker로 구동되는 스프링에 대한 보안을 설정해야한다.

## 1-4.2 보안 그룹 ID 리스트 확인하기

![](https://i.imgur.com/DxjOsP5.png)

![](https://i.imgur.com/jlbzAJi.png)


  
default로 생성된 보안 그룹은 `launch-wizard-1`이다. 보안 그룹은 인스턴스와 별개로 존재하기 때문에 한번 만들어두면 새로운 인스턴스에도 적용할 수 있다.

보안 그룹 생성 버튼으로 새로운 보안 그룹을 만들어보자.

## 1-4.3 보안 그룹 생성하기

![](https://i.imgur.com/B9MLtn4.png)

보안 그룹의 이름과 설명을 추가한다.

### ✅ 인바운드 규칙 편집하기

![](https://i.imgur.com/RQ6cDrM.png)


인바운드 규칙은 외부에서 EC2로 요청할 때 허용할 IP 대역을 설정하는 것이다.

로컬 PC에서 서버에 접속할 수 있게 SSH를 추가하고 소스를 내 IP로 추가한다. 소스를 선택하면 자동으로 IP가 추가되고, 특정 IP를 넣으려면 사용자 지정으로 추가할 수 있다.

여러 사람이 함께 작업하는 프로젝트라면 각각의 로컬 PC IP를 전부 추가해주어야 한다.

SSH, HTTP, HTTPS와 같은 기본 프로토콜들과 스프링 부트 프로젝트까지 사용자 지정으로 추가해준다.

### ✅ 아웃바운드 규칙 편집하기

아웃바운드 규칙은 따로 설정할 필요가 없어서 그대로 둔다.

이후 보안 그룹 생성 버튼을 눌러주어 작업을 완료한다.

## 1-4.4 보안 그룹 변경하기

![](https://i.imgur.com/esKRl99.png)


인스턴스 요약 창으로 돌아와 우측 상단 **작업 > 보안 그룹 변경 버튼**을 눌러준다.

![](https://i.imgur.com/ne3CgL4.png)
(위 이미지는 참고한 블로그에서 가져온 이미지로 보안 그룹 이름이 진행 과정과 상이하지만, 그 외에는 변동 사항이 없습니다.)

보안 그룹은 여러 개를 동시에 설정할 수 있다. 기존에 설정되었던 `launch-wizard-1`을 제거한 후 새로 생성한 보안 그룹을 추가한다.

![](https://i.imgur.com/FEm9OZF.png)
(위 이미지는 참고한 블로그에서 가져온 이미지로 보안 그룹 이름이 진행 과정과 상이하지만, 그 외에는 변동 사항이 없습니다.)


# RDS_생성하기
![](https://i.imgur.com/TNFLT3F.png)


> [!NOTE]
> RDS란 AWS에서 관계형 데이터베이스를 더 쉽게 설치, 운영 및 확장할 수 있는 웹서비스이다.
> - Amazon Aurora(MySQL 호환), Amazon Aurora(PostgreSQL 호환), MySQL, MariaDB, PostgreSQL, Oracle 등 7가지 엔진을 제공한다.
> - 인프라 프로비저닝, 데이터베이스 설정, 백업, 장애 탐지, 복구 등의 작업을 자동화하여 비용과 시간을 감소시키고, 효율적인 데이터베이스 관리가 가능하다.


## 1-1.RDS 이동 및 데이터베이스 생성

![](https://i.imgur.com/TPp9AaO.png)


![](https://i.imgur.com/98ZdfsD.png)

생성한 데이터베이스가 없다면 대쉬보드에서 바로 생성 버튼으로 접근 가능하다. 좌측 데이터베이스 메뉴를 클릭해 데이터베이스 생성 버튼으로도 접근 가능하다.

### ✅ 데이터베이스 엔진 옵션 선택하기

![](https://i.imgur.com/1kCU1cc.png)

사용할 데이터베이스 엔진을 선택한다. 여기서는 MySQL을 선택했다.

![](https://i.imgur.com/Htgyo0H.png)

템플릿은 프리 티어를 선택한다. 자동으로 가용성 및 내구성 필드가 비활성화된다.

### ✅ 데이터베이스 설정 입력하기

![](https://i.imgur.com/yixhOtp.png)

데이터베이스 이름, 마스터 이름, 마스터 암호를 입력한다.  
데이터베이스에 접근할 때 사용할 정보이므로 안전한 곳에 기록해두자

### ✅ 인스턴스 구성/스토리지 설정하기

![](https://i.imgur.com/VQ3qLhb.png)

프리 티어는 대부분 기본 설정을 사용하면 된다.

> 스토리지 자동 조정 활성화는 체크 해제해놔야 한다. 체크를 해제하지 않으면 임계값이 초과되었을 때 자동으로 스토리지가 늘어나서 과금될 가능성이 있다.

### ✅ VPC 보안 그룹 설정하기


![](https://i.imgur.com/qiSTfgl.png)

EC2랑 연결하는 옵션을 선택해서 생성하면 외부접속이 불가능하다. 그렇기에 연결을 안하는 옵션을 선택해줬다.

서브넷 그룹을 새로 생성해줄 것이기 때문에 새 VPC 생성을 선택해준다.

퍼블릭 액세는 `예`로 해주어야 외부에서 접속할 수 있다. 보안 그룹도 새로 생성해준다.

새 VPC 보안 그룹 이름은 자유롭게 작성하자.

### ✅ 추가 설정

![](https://i.imgur.com/7McqUzg.png)

- 초기 데이터베이스 이름을 설정
- 자동 백업 체크 해제

프리티어 요금에 대한 안내를 읽고, 데이터베이스 생성을 눌러 생성을 완료한다.
![](https://i.imgur.com/z87sSr8.png)

![](https://i.imgur.com/I4LQeJA.png)

**RDS > 데이터베이스** 에서 성공적으로 생성된 것을 확인할 수 있다.


## 1-2. 보안그룹 설정

RDS 인스턴스를 생성할 때 보안그룹을 생성해주었다. 데이터베이스는 서버에서 접근 가능해야 하기 때문에 보안 그룹 설정이 추가로 필요하다.

> 서버는 탄력적 IP를 뜻한다.


## 1-2.1 보안 그룹 확인하기


![](https://i.imgur.com/cBxsdMW.png)

RDS 인스턴스 정보에서 보안 그룹 규칙을 확인할 수 있다. 기본 설정은 로컬 IP만 인바운드 규칙에 추가되어 있다.  
아웃바운드는 모든 트래픽에 대해 열려있다.

> [!NOTE]
> RDS 보안 그룹은 EC2 보안 그룹이랑 별도로 관리하지 않고 같은 곳에서 관리한다. 보안 그룹을 편집하기 위해서는 EC2 대시보드로 이동하거나 저 보안 그룹 이름을 클릭해 페이지를 열어야 한다.


## 1-2.2 보안 그룹 편집하기

![](https://i.imgur.com/jj5vJ1h.png)

  
EC2 인스턴스의 탄력적 IP를 추가해준다.